<!DOCTYPE html!>
<head>

            <title>Authentication - sabre/dav</title>
    
    <link rel="stylesheet" type="text/css" href="/css/sabredav.css" />
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:100,700,300,400" type="text/css">
    <link rel="stylesheet" href="/components/highlightjs/styles/github.css" type="text/css" />

    <link rel="shortcut icon" href="/favicon.ico" />

</head>
<body>
    <header>

    <div class="logo">
        <a href="/">
            <img src="/img/logo.png" alt="SabreDAV. A WebDAV framework for PHP.">
            SabreDAV wiki
        </a>
    </div>

    <nav>
        <ul>
            <li><a href="/">sabre/dav</a></li>
            <li><a href="/">sabre/event</a></li>
            <li><a href="/">sabre/http</a></li>
            <li><a href="/">sabre/vobject</a></li>
        </ul>
    </nav>

</header>

    <main>
        <aside>
    <ul>
        <li><a href="/">Home</a></li>
        <li><a href="/dav/install">Installation</a></li>
        <li><a href="/dav/upgrading">Upgrading</a></li>
        <li><a href="/dav/gettingstarted">Getting Started</a></li>
        <li>
            Troubleshooting
            <ul>
                <li><a href="/dav/faq">FAQ</a></li>
                <li><a href="/dav/clients">Clients</a></li>
                <li><a href="/dav/webservers">Webservers</a></li>
            </ul>
        </li>
        <li>
            CalDAV
            <ul>
                <li><a href="/dav/caldav">Getting started</a></li>
                <li><a href="/dav/building-a-caldav-client">Building a CalDAV client</a></li>
                <li><a href="/dav/caldav-carddav-integration-guide">Integration guide</a></li>
                <li><a href="/dav/caldav-proxy">Delegation</a></li>
                <li><a href="/dav/caldav-sharing">Calendar sharing</a></li>
                <li><a href="/dav/ics-export-plugin">iCalendar export</a></li>
                <li><a href="/dav/imiphandler">iMip Handler</a></li>
                <li><a href="/dav/service-discovery">Service Discovery</a></li>
            </ul>
        </li>
        <li>
            CardDAV
            <ul>
                <li><a href="/dav/carddav">Getting started</a></li>
                <li><a href="/dav/caldav-carddav-integration-guide">Integration guide</a></li>
                <li><a href="/dav/carddav-directory">CardDAV Directory</a></li>
                <li><a href="/dav/service-discovery">Service Discovery</a></li>
            </ul>
        </li>
        <li>
            Other topics
            <ul>
                <li><a href="/dav/acl">Acl</a></li>
                <li><a href="/dav/authentication">Authentication</a></li>
                <li><a href="/dav/character-encoding">Character encoding</a></li>
                <li><a href="/dav/browser-plugin">Directory indexes</a></li>
                <li><a href="/dav/davmount">DavMount</a></li>
                <li><a href="/dav/guesscontenttype">Content Types</a></li>
                <li><a href="/dav/http-patch">PATCH support</a></li>
                <li><a href="/license">License</a></li>
                <li><a href="/dav/litmus">Litmus</a></li>
                <li><a href="/dav/plugins">Plugins</a></li>
                <li><a href="/dav/scalability">Scalability</a></li>
                <li><a href="/dav/simplecollection">SimpleCollection</a></li>
                <li><a href="/dav/standards-support">Standards Support</a></li>
                <li><a href="/dav/temporary-files">Temporary Files</a></li>
                <li><a href="/dav/versioning">Versioning</a></li>
                <li><a href="/dav/virtual-filesystems">Virtual filesystems</a></li>
                <li><a href="/dav/xmlelements">XML Elements</a></li>
            </ul>
        </li>
    </ul>
</aside>
        <article>
                        <h1>Authentication</h1>            <p>After setting up your DAV server, you will probably want to add some security.
The standard way to do this, is to add HTTP Basic or HTTP Digest authentication
support.</p>

<p>sabre/dav comes with a plugin that handles authentication for you. It is
recommended to use this plugin, and it is required to use for both
<a href="/dav/caldav">cal-</a> and <a href="/dav/carddav">carddav</a>.</p>

<p>The plugin can work with different backends. SabreDAV ships with a number of
backends, but it's also easy to create your own.</p>

<h2>Backends</h2>

<p>SabreDAV comes with the following backends:</p>

<table>
<thead>
<tr>
  <th>Class</th>
  <th>Type</th>
  <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>Sabre\DAV\Auth\Backend\Apache</code></td>
  <td>N/A</td>
  <td>Lets the webserver handle auhtentication</td>
</tr>
<tr>
  <td><code>Sabre\DAV\Auth\Backend\BasicCallback</code></td>
  <td>Basic</td>
  <td>Extremely easy way to create authentication from a custom source</td>
</tr>
<tr>
  <td><code>Sabre\DAV\Auth\Backend\File</code></td>
  <td>Digest</td>
  <td>Use a <code>htdigest</code> file for it's backend</td>
</tr>
<tr>
  <td><code>Sabre\DAV\Auth\Backend\PDO</code></td>
  <td>Digest</td>
  <td>Use a database, such as sqlite or mysql</td>
</tr>
</tbody>
</table>

<h2>Using the PDO backend</h2>

<p>The PDO backend can either use MySQL or SQLite databases. An example for the
table creation can be found in the <a href="https://github.com/fruux/sabre-dav/tree/master/examples/sql">source</a> in the examples/sql directory.</p>

<p>Assuming you already have a server up and running, add the plugin using the
following code:</p>

<pre><code>use Sabre\DAV\Auth;

$pdo = new \PDO('sqlite:data/db.sqlite');
// or alternatively:
// $pdo = new \PDO('mysql:dbname=sabredav','username','password');

// Throwing exceptions when PDO comes across an error:
$pdo-&gt;setAttribute(PDO::ATTR_ERRMODE,PDO::ERRMODE_EXCEPTION);

// Creating the backend
$authBackend = new Auth\Backend\PDO($pdo);

// Creating the plugin. We're assuming that the realm
// name is called 'SabreDAV'.
$authPlugin = new Auth\Plugin($authBackend,'SabreDAV');

// Adding the plugin to the server
$server-&gt;addPlugin($authPlugin);
</code></pre>

<h3>The SQL table</h3>

<p>The example scripts for the SQL tables automatically creates a user with the
username <code>admin</code> and password <code>admin</code>. Change this!</p>

<p>You might be confused by the <code>digesta1</code> field. This field actually contains
the hashed password. The password is stored in the following format:</p>

<pre><code>md5('username:realm:password');
</code></pre>

<p>The username and password speak for themselves, but it's important to keep
the <code>realm</code> in mind. This must be the very same realm you specified earlier
when creating the <code>Sabre\DAV\Auth\Plugin</code>.</p>

<p>If you choose to change the realm in the plugin, existing passwords will be
invalidated, because the hash changed for all of them.</p>

<h2>Using the File backend</h2>

<p>The <code>Sabre\DAV\Auth\Backend\File</code> backend uses a simple file to store
usernames and passwords. The format of the file is identical to apache's
htdigest file.</p>

<p>If you have apache installed, there's a good chance you have a utility
to create and modify these files. You can verify this by typing <code>htdigest</code>
on the command line.</p>

<p>If you don't have htdigest installed, the format is rather simple.
Every user is on a single line (split by \n). Every line looks like:</p>

<pre><code>username:realm:digesta1
</code></pre>

<p>The username speaks for itself, the realm must be the exact same as the second
argument of the <code>Sabre\DAV\Auth\Plugin</code> constructor, and the digest a1 is,
just like with the PDO plugin the following hash:</p>

<pre><code>md5('username:realm:password');
</code></pre>

<p>So, given a username of 'foo', a password of 'bar', and a realm of 'SabreDAV',
the resulting hash should be:</p>

<pre><code>php -r "echo md5('foo:SabreDAV:bar');"
5790c3784a79a018d1186528df520e11
</code></pre>

<p>Then our htdigest file looks like:</p>

<pre><code>foo:SabreDAV:5790c3784a79a018d1186528df520e11
</code></pre>

<p>To use this file:</p>

<pre><code>use Sabre\DAV\Auth;

$authBackend = new Auth\Backend\File('/path/to/htdigest');
$authPlugin = new Auth\Plugin($authBackend, 'SabreDAV');

// Adding the plugin to the server
$server-&gt;addPlugin($authPlugin);
</code></pre>

<h2>Creating your own authentication backend</h2>

<p>If you're going to add Digest authenticaton, use
<code>Sabre\DAV\Auth\Backend\AbstractDigest</code> as your parent class, and the
<code>Sabre\DAV\Auth\Backend\File</code> and <code>Sabre\DAV\Auth\Backend\PDO</code>
classes as examples.</p>

<p>If you're going to implement HTTP Basic, you must use
<code>Sabre\DAV\Auth\Backend\AbstractBasic</code> as your parent class and implement the
validateUserPass method.</p>

<h2>Webserver configuration</h2>

<p>Some webservers may require special configuration for authentication to work.
Take a look at <a href="/dav/webservers">Webservers</a> for more information.</p>

<h3>Problems with safe mode</h3>

<p>If 'safe mode' is enabled, PHP will automatically append a process id to authentication realms. This is problematic for Digest authentication, as it used the realm to determine the hash.</p>

<p>The solution to this is to either turn off Safe Mode, or using Basic authentication instead of Digest.</p>

<p>See <a href="http://php.net/manual/en/features.http-auth.php">the PHP manual</a> for more information.</p>

<h2>Letting the webserver handle authentication</h2>

<p>Authentication can be directly handled by webservers as well. This approach
can be useful if you want to use advanced authentication methods provided by
Apache modules (for instance LDAP, Kerberos or SASL).</p>

<p>The backend to support this is called <code>Sabre\DAV\Auth\Backend\Apache</code>, to use
it add the plugin as follows:</p>

<pre><code>use Sabre\DAV\Auth;

// Creating the backend
$authBackend = new Auth\Backend\Apache();

// Creating the plugin. The realm parameter is ignored by the backend
$authPlugin = new Auth\Plugin($authBackend,'SabreDAV');

// Adding the plugin to the server
$server-&gt;addPlugin($authPlugin);
</code></pre>
                    </article>
    </main>

    <script src="/components/highlightjs/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-2848664-5', 'sabredav.org');
ga('send', 'pageview');
</script>

    
</body>
