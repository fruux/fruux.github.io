<!DOCTYPE html!>
<head>
    <title>sabre/dav</title>

    <link rel="stylesheet" type="text/css" href="/css/sabredav.css" />
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:100,700,300,400" type="text/css">
    <link rel="stylesheet" href="/components/highlightjs/styles/github.css" type="text/css" />

    <link rel="shortcut icon" href="/favicon.ico" />

</head>
<body>
    <header>

    <div class="logo">
        <a href="/">
            <img src="/img/logo.png" alt="SabreDAV. A WebDAV framework for PHP.">
            SabreDAV wiki
        </a>
    </div>

    <nav>
        <ul>
            <li><a href="/">sabre/dav</a></li>
            <li><a href="/">sabre/event</a></li>
            <li><a href="/">sabre/http</a></li>
            <li><a href="/">sabre/vobject</a></li>
        </ul>
    </nav>

</header>

    <main>
        <aside>
    <ul>
        <li><a href="/">Home</a></li>
        <li><a href="/dav/install">Installation</a></li>
        <li><a href="/dav/upgrading">Upgrading</a></li>
        <li><a href="/dav/gettingstarted">Getting Started</a></li>
        <li>
            Troubleshooting
            <ul>
                <li><a href="/dav/faq">FAQ</a></li>
                <li><a href="/dav/clients">Clients</a></li>
                <li><a href="/dav/webservers">Webservers</a></li>
            </ul>
        </li>
        <li>
            CalDAV
            <ul>
                <li><a href="/dav/caldav">Getting started</a></li>
                <li><a href="/dav/building-a-caldav-client">Building a CalDAV client</a></li>
                <li><a href="/dav/caldav-carddav-integration-guide">Integration guide</a></li>
                <li><a href="/dav/caldav-proxy">Delegation</a></li>
                <li><a href="/dav/caldav-sharing">Calendar sharing</a></li>
                <li><a href="/dav/ics-export-plugin">iCalendar export</a></li>
                <li><a href="/dav/imiphandler">iMip Handler</a></li>
            </ul>
        </li>
        <li>
            CardDAV
            <ul>
                <li><a href="/dav/carddav">Getting started</a></li>
                <li><a href="/dav/caldav-carddav-integration-guide">Integration guide</a></li>
                <li><a href="/dav/carddav-directory">CardDAV Directory</a></li>
            </ul>
        </li>
        <li>
            Other topics
            <ul>
                <li><a href="/dav/acl">Acl</a></li>
                <li><a href="/dav/authentication">Authentication</a></li>
                <li><a href="/dav/character-encoding">Character encoding</a></li>
                <li><a href="/dav/browser-plugin">Directory indexes</a></li>
                <li><a href="/dav/davmount">DavMount</a></li>
                <li><a href="/dav/guesscontenttype">Content Types</a></li>
                <li><a href="/license">License</a></li>
                <li><a href="/dav/litmus">Litmus</a></li>
                <li><a href="/dav/plugins">Plugins</a></li>
                <li><a href="/dav/partialupdate">PATCH support</a></li>
                <li><a href="/dav/scalability">Scalability</a></li>
                <li><a href="/dav/versioning">Versioning</a></li>
                <li><a href="/dav/virtual-filesystems">Virtual filesystems</a></li>
            </ul>
        </li>
    </ul>
</aside>
        <article>
            
<h1>iCal</h1>

<p>iCal (now known as just 'Calendar'), is one of the most feature-rich CalDAV
clients on there. A lot of testing with SabreDAV first happens with iCal,
as it tends to be the forerunner in supporting new standards, and also tends
to be the most correct implementation.</p>

<p>At the very least it has support for:</p>

<ul>
<li><a href="http://tools.ietf.org/html/rfc4791">CalDAV</a></li>
<li><a href="http://tools.ietf.org/html/rfc6638">Scheduling</a></li>
<li><a href="/dav/caldav-proxy">Calendar delegation</a></li>
<li><a href="/dav/caldav-sharing">Calendar sharing</a></li>
</ul>

<h2>Technical information</h2>

<h3>Debugging</h3>

<p>To enable the debug menu within ical, run the following on the command line:</p>

<pre><code>defaults write com.apple.iCal IncludeDebugMenu 1
</code></pre>

<p>Since OS X 10.9 (mavericks, this has changed to)</p>

<pre><code>defaults write com.apple.iCal CDB 1
</code></pre>

<p>To enable logging:</p>

<pre><code>defaults write com.apple.iCal LogHTTPActivity -boolean TRUE
</code></pre>

<p>Logging goes to 'Console.app'</p>

<h3>User agent</h3>

<p>Some user agents we've seen:</p>

<pre><code>DAVKit/3.0.6 (661); CalendarStore/3.0.8 (860); iCal/3.0.8 (1287); Mac OS X/10.5.8 (9L31a)
DAVKit/4.0.1 (730); CalendarStore/4.0.1 (973); iCal/4.0.1 (1374); Mac OS X/10.6.2 (10C540)
</code></pre>

<h3>10.5 iCal</h3>

<p>To setup 10.5 iCal a full principal url must be provided. On this principal url, iCal will request the following:</p>

<pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;x0:propfind xmlns:x2="http://calendarserver.org/ns/" xmlns:x1="urn:ietf:params:xml:ns:caldav" xmlns:x0="DAV:"&gt;
 &lt;x0:prop&gt;
  &lt;x1:calendar-home-set/&gt;
  &lt;x1:calendar-user-address-set/&gt;
  &lt;x1:schedule-inbox-URL/&gt;
  &lt;x1:schedule-outbox-URL/&gt;
  &lt;x2:dropbox-home-URL/&gt;
  &lt;x2:notifications-URL/&gt;
  &lt;x0:displayname/&gt;
 &lt;/x0:prop&gt;
&lt;/x0:propfind&gt;
</code></pre>

<p>What's mainly important here is the calendar-home-set, which contains a url with a reference to all the calendars.</p>

<p>On this calendar url, the following PROPFIND request is made:</p>

<pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;x0:propfind xmlns:x1="http://calendarserver.org/ns/" xmlns:x0="DAV:" xmlns:x3="http://apple.com/ns/ical/" xmlns:x2="urn:ietf:params:xml:ns:caldav"&gt;
 &lt;x0:prop&gt;
  &lt;x1:getctag/&gt;
  &lt;x0:displayname/&gt;
  &lt;x2:calendar-description/&gt;
  &lt;x3:calendar-color/&gt;
  &lt;x3:calendar-order/&gt;
  &lt;x0:resourcetype/&gt;
  &lt;x2:calendar-free-busy-set/&gt;
 &lt;/x0:prop&gt;
&lt;/x0:propfind&gt;
</code></pre>

<h3>10.6 iCal</h3>

<p>10.6 iCal does not require a full principal url, as it can automatically
discover these. See <a href="/dav/service-discovery">Service Discovery</a> for a bit
more detail.</p>

<p>It will request the following properties on the principal url.</p>

<ul>
<li>DAV: principal-collection-set</li>
<li>CalDAV: calendar-home-set</li>
<li>CalDAV: calendar-user-address-set</li>
<li>CalDAV: schedule-inbox-URL</li>
<li>CalDAV: schedule-outbox-URL</li>
<li>CalendarServer: dropbox-home-URL</li>
<li>CalendarServer: xmpp-uri</li>
<li>DAV: displayname</li>
<li>DAV: principal-URL</li>
<li>DAV: supported-report-set</li>
</ul>

<p>After finding the calendar-home-url, the following is requested for calendars:</p>

<pre><code>&lt;x0:propfind xmlns:x0="DAV:" xmlns:x3="http://apple.com/ns/ical/" 
  xmlns:x1="http://calendarserver.org/ns/" xmlns:x2="urn:ietf:params:xml:ns:caldav"&gt; 
    &lt;x0:prop&gt; 
        &lt;x1:xmpp-server /&gt; 
        &lt;x1:xmpp-uri /&gt; 
        &lt;x1:getctag /&gt; 
        &lt;x0:displayname /&gt; 
        &lt;x2:calendar-description /&gt; 
        &lt;x3:calendar-color /&gt; 
        &lt;x3:calendar-order /&gt; 
        &lt;x2:supported-calendar-component-set /&gt; 
        &lt;x0:resourcetype /&gt; 
        &lt;x2:calendar-free-busy-set /&gt; 
        &lt;x2:schedule-calendar-transp /&gt; 
        &lt;x2:schedule-default-calendar-URL /&gt; 
        &lt;x0:quota-available-bytes /&gt; 
        &lt;x0:quota-used-bytes /&gt; 
        &lt;x2:calendar-timezone /&gt; 
        &lt;x0:current-user-privilege-set /&gt; 
    &lt;/x0:prop&gt; 
&lt;/x0:propfind&gt;
</code></pre>

<h3>10.7 and up</h3>

<p>More details to follow</p>

<h3>Bugs</h3>

<h4>Assuming scheduling support</h4>

<p>iCal appears to assume that any CalDAV server also supports from
CalDAV-scheduling features out of the box. iCal will use this to let the server
send emails, for things like an event invitation.</p>

<p>If this is not supported, no emails for these types of actions will be sent.
This can be rather unexpected for users, as these expected emails just won't
arrive.</p>

<p>Since version 1.6 SabreDAV has a workaround for this. Read
<a href="/dav/imiphandler">IMipHandler</a> for more details.</p>

<p>This issue has been discovered on at least 10.7 and 10.8 iCal, not yet sure about older versions.</p>

<h4>Trailing slash (iCal 10.5 and iCal 10.6)</h4>

<p>It was reported on several wiki's iCal needs a trailing slash for the url to
connect to (the principal url). This is not enough however, the <code>{DAV:}href</code>
element in the {DAV:}response element MUST also have this trailing url.</p>

<p>Without it errors such as the following can come up:</p>

<ul>
<li>"the server has not specified a calendar home ... "</li>
<li>"here was an unexpected error with the request (domain CalDAVErrorDomain /
error 5 / description 'The server has not specified a calendar home for the
account at .."</li>
</ul>

<p>A workaround is in place in SabreDAV.</p>

<h4>iCal depends on a DAV: header to be set in all PROPFIND responses</h4>

<p>Traditionally the DAV: header is only needed in the OPTIONS request. If
calendar-proxy support is required, this header must also be set in other
responses. In particular, iCal seems to pick up on it if it's set in a
PROPFIND response.</p>

<p>Since SabreDAV 1.5 we always send along the DAV: header for every PROPFIND
responses.</p>
 

        </article>
    </main>

    <script src="/components/highlightjs/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-2848664-5', 'sabredav.org');
ga('send', 'pageview');
</script>

    
</body>
