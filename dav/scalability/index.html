<!DOCTYPE html>
<head>

  
            <title>Scalability - sabre/dav</title>
    
    <meta charset="utf-8">

    <link rel="alternate" type="application/atom+xml" href="http://sabre.io/atom.xml" title="sabre.io blog" />
    <link rel="shortcut icon" href="http://sabre.io/favicon.ico" />
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:100,700,300,400" type="text/css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
            <link rel="stylesheet" type="text/css" href="http://sabre.io/css/sabre.css" />
    
</head>
<body >
    <header class="pagehead">

    <div class="pagehead-inner">
        <a class="logo" href="http://sabre.io/">
            <img src="http://sabre.io/img/logo.png" alt="sabre/dav">
            sabre<span>/dav</span>
        </a>

        <nav class="nav nav--page">
            <ul>
                <li class="size-auto"></li>
                <li><a href="http://sabre.io/dav">Docs</a></li>
                <li><a href="http://sabre.io/blog">Blog</a></li>
                <li><a href="http://sabre.io/support">Support</a></li>
                <li class="size-auto text--right"><a href="https://github.com/fruux?query=sabre"><i class="fa fa-github"></i></a></li>
                <!-- <li><a href="http://sabre.io/atom.xml"><i class="fa fa-rss"></i></a> <a href="https://twitter.com/sabredav"><i class="fa fa-twitter"></i></a></li> -->
            </ul>
        </nav>

    </div>

</header>

            <input class="hamburger-input" type="checkbox" id="nav-check" name="nav-check">
        <label class="hamburger-label" for="nav-check"><i class="fa fa-bars"></i></label>
    
        <main class="incl-sidebar">
                    <aside class="sidebar">
    <nav class="nav nav--sidebar">
        <ul class="list list--nav">
            <li><a href="http://sabre.io/dav">sabre/dav</a>
                                <ul>
                    <li><a href="http://sabre.io/dav/install">Installation</a></li>
                    <li><a href="http://sabre.io/dav/upgrading">Upgrading</a></li>
                    <li><a href="http://sabre.io/dav/gettingstarted">Getting Started</a></li>
                    <li>Troubleshooting
                        <ul>
                            <li><a href="http://sabre.io/dav/faq">FAQ</a></li>
                            <li><a href="http://sabre.io/dav/clients">Clients</a></li>
                            <li><a href="http://sabre.io/dav/webservers">Webservers</a></li>
                        </ul>
                    </li>
                    <li>CalDAV
                        <ul>
                            <li><a href="http://sabre.io/dav/caldav">Getting started</a></li>
                            <li><a href="http://sabre.io/dav/building-a-caldav-client">Building a CalDAV client</a></li>
                            <li><a href="http://sabre.io/dav/caldav-carddav-integration-guide">Integration guide</a></li>
                            <li><a href="http://sabre.io/dav/caldav-proxy">Delegation</a></li>
                            <li><a href="http://sabre.io/dav/caldav-sharing">Calendar sharing</a></li>
                            <li><a href="http://sabre.io/dav/ics-export-plugin">iCalendar export</a></li>
                            <li><a href="http://sabre.io/dav/scheduling">Scheduling</a></li>
                            <li><a href="http://sabre.io/dav/service-discovery">Service Discovery</a></li>
                        </ul>
                    </li>
                    <li>CardDAV
                        <ul>
                            <li><a href="http://sabre.io/dav/carddav">Getting started</a></li>
                            <li><a href="http://sabre.io/dav/building-a-carddav-client">Building a CardDAV client</a></li>
                            <li><a href="http://sabre.io/dav/caldav-carddav-integration-guide">Integration guide</a></li>
                            <li><a href="http://sabre.io/dav/carddav-directory">CardDAV Directory</a></li>
                            <li><a href="http://sabre.io/dav/vcf-export-plugin">vCard export</a></li>
                            <li><a href="http://sabre.io/dav/service-discovery">Service Discovery</a></li>
                        </ul>
                    </li>
                    <li>Other topics
                        <ul>
                            <li><a href="http://sabre.io/dav/acl">Acl</a></li>
                            <li><a href="http://sabre.io/dav/authentication">Authentication</a></li>
                            <li><a href="http://sabre.io/dav/character-encoding">Character encoding</a></li>
                            <li><a href="http://sabre.io/dav/browser-plugin">Directory indexes</a></li>
                            <li><a href="http://sabre.io/dav/davmount">DavMount</a></li>
                            <li><a href="http://sabre.io/dav/guesscontenttype">Content Types</a></li>
                            <li><a href="http://sabre.io/dav/http-patch">PATCH support</a></li>
                            <li><a href="http://sabre.io/dav/large-files">Large files</a></li>
                            <li><a href="http://sabre.io/dav/litmus">Litmus</a></li>
                            <li><a href="http://sabre.io/dav/locks">Locks</a></li>
                            <li><a href="http://sabre.io/dav/plugins">Plugins</a></li>
                            <li><a href="http://sabre.io/dav/per-user-directories/">Per-user directories</a></li>
                            <li><a href="http://sabre.io/dav/properties">Properties</a></li>
                            <li><a href="http://sabre.io/dav/property-storage">Property storage</a></li>
                            <li><a href="http://sabre.io/dav/scalability">Scalability</a></li>
                            <li><a href="http://sabre.io/dav/simplecollection">SimpleCollection</a></li>
                            <li><a href="http://sabre.io/dav/standards-support">Standards Support</a></li>
                            <li><a href="http://sabre.io/dav/temporary-files">Temporary Files</a></li>
                            <li><a href="http://sabre.io/dav/versioning">Versioning</a></li>
                            <li><a href="http://sabre.io/dav/virtual-filesystems">Virtual filesystems</a></li>
                            <li><a href="http://sabre.io/dav/davclient">WebDAV client</a></li>
                            <li><a href="http://sabre.io/dav/sync">WebDAV sync</a></li>
                            <li><a href="http://sabre.io/dav/writing-plugins">Writing Plugins</a></li>
                            <li><a href="http://sabre.io/dav/xmlelements">XML Elements</a></li>
                        </ul>
                    </li>
                </ul>
                            </li>
            <li><a href="http://sabre.io/event">sabre/event</a>
                            </li>
            <li><a href="http://sabre.io/http">sabre/http</a>
                            </li>
            <li><a href="http://sabre.io/vobject">sabre/vobject</a>
                            </li>
            <li><a href="http://sabre.io/xml">sabre/xml</a>
                            </li>
            <li><a href="http://sabre.io/uri">sabre/uri</a>
                            </li>
            <li><a href="http://sabre.io/license">License</a></li>
        </ul>
    </nav>
</aside>
                <article>
                            <h1>Scalability</h1>
                <p>While the default library suffices for small-scall WebDAV installations, there are areas that can be optimized for maximum performance, and operations in a load-balanced environment.</p>

<p>This manual aims to cover the most important bits.</p>

<h2 id="objecttree">ObjectTree</h2>

<p>All operations are done on Nodes managed by the ObjectTree. In order for the ObjectTree to find the nodes, it must traverse the entire tree.</p>

<p>You should optimize <code>getChildren()</code> and <code>getChild()</code> in your nodes as much as possible to accomodate for it.</p>

<p>You can avoid traversing the tree by subclassing <code>Sabre\DAV\ObjectTree</code> and overriding <code>getChild</code>, <code>getChildren</code> and <code>childExists</code> with your own methods.</p>

<p>If this really helps you highly depends on your situation. Profile first, optimize after.</p>

<h3 id="move-and-copy">Move and Copy</h3>

<p>Move and Copy operations can be slow, especially when moving/copying bigger objects.</p>

<p>Each of these methods traverses the entire tree, and operates on them one-by-one, as an example, a move of a directory follows the following pattern:</p>

<ul>
<li>The ObjectTree tranverses the entire source tree, for each item it will

<ul>
<li>do a get() on the source file, and a createFile on the destination (heavy)</li>
<li>make subdirectories if directories are encountered</li>
<li>copy all the properties over in a similar fashion (if IProperties is used)</li>
</ul></li>
<li>Next, (if it was a move operation) it will traverse the entire source tree again, deleting all files and directories one-by-one</li>
</ul>

<p>You can override the copy and move functionality by subclassing the ObjectTree, if this makes sense for you. In addition, if you purely use SabreDAV to expose a filesystem, you can choose to use <code>Sabre\DAV\Tree\Filesystem</code> instead of <code>Sabre\DAV\ObjectTree</code>. This class is specifically optimized for plain filesystems.</p>

<h3 id="delete">Delete</h3>

<p>Deleting files has similar problems, as it will also generally traverse the objecttree. If you have created your own File and Directory objects, you might be able to optimize access by overriding <code>delete()</code>, if your backends allow it.</p>

<h2 id="caldav">CalDAV</h2>

<p>If you created your own CalDAV backend, it may make sense to try to optimize <code>calendarQuery</code>. The <code>Sabre\CalDAV\Backend\AbstractBackend</code> class provides a standard implementation, that fetches every object for a calendar and tries to see if the query filters out the object, or not.</p>

<p>The <code>Sabre\CalDAV\Backend\PDO</code> class tries to optimize this, by filtering a bunch of common queries and directly applying them to the SQL queries.</p>

<p>In some cases it's confident enough to know that no further iCalendar parsing is needed to figure out the final results.</p>

<p>It is also recommended to make sure that your <code>getCalendarObjects</code> method does not return the iCalendar object, but it does return the 'size' and 'etag' property.</p>

<p>This allows the server to not have to fetch the objects at all for certain large operations, which can save a lot of memory.</p>

<h2 id="load-balanced-sabredav">Load Balanced SabreDAV</h2>

<p>SabreDAV has a few standard utilities for locking and catching 'temporary
files'. These classes (<code>Sabre\DAV\TemporaryFileFilterPlugin</code> and
<code>Sabre\DAV\Locks\Backend\FS</code>) store information on the filesystem.</p>

<p>It would be possible to store these files on a network location instead, as
long as the network filesystem has proper support for flock() (which NFS as an
example doesn't).</p>

<p>Storing locks could be implemented in a database server or caching layer such
as memcached, the temporary files are a bit bigger, so that might pose some
issues. We chose to not supply any plugins for these alternative backends, as
there are a lot of options out there and impossible to cover them all. Instead
it was made really easy to extend these subsystems.</p>

<p>Currently 'temporary files' don't get cleaned up, and a cron job should be
made to delete older files (>1 hour).</p>

<h2 id="large-files">Large Files</h2>

<p>Read: <a href="/dav/large-files">Working with large files</a>.</p>
            
            
                            <hr />
                <h2>Comments</h2>
                <div id="disqus_thread"></div>
                    </article>
    </main>
    
    <!-- this is where the ugly bit starts. Stupid javascript :( -->

    <script src="http://sabre.io/components/highlightjs/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-2848664-5', 'sabre.io');
ga('send', 'pageview');
</script>

    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'sabredav'; // required: replace example with your forum shortname
    var disqus_identifier = '/dav/scalability/';
    var disqus_title = 'Scalability';
    var disqus_url = 'http://sabre.io/dav/scalability/';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
         var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
         dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
         (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
 </script>

    <footer>

    <nav>
        <ul>
            <li>© 2015 <a href="https://fruux.com">fruux GmbH</a> · </li>
            <li><a href="http://sabre.io/support">Contact</a> · </li>
            <li><a href="http://sabre.io/legal">Legal Info</a></li>
        </ul>
        <ul>
            <li><i class="fa fa-twitter"></i> <a href="http://twitter.com/sabredav">@sabredav</a> · </li>
            <li><a href="http://twitter.com/fruux">@fruux</a></li>
                    </ul>
    </nav>

</footer>

</body>
